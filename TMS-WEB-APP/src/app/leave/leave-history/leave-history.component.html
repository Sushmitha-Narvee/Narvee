<div class="leave-container">
  <!-- Header with actions -->
  <div
    class="header-row"
    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;"
  >
    <h2>Leave History</h2>
    <div>
      <!-- Always visible for users -->
      <button mat-raised-button color="primary" (click)="openApplyLeave()">
        Apply Leave
      </button>

      <!-- Visible only if user is manager/super admin -->
      <button
        mat-raised-button
        color="accent"
        *ngIf="isManager"
        (click)="openManageLeaves()"
        style="margin-left:8px;"
      >
        Manage Leaves
      </button>
    </div>
  </div>

  <!-- Loading -->
  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <!-- Empty state -->
  <div
    *ngIf="!loading && (!leaves || leaves.length === 0)"
    class="mat-elevation-z1"
    style="padding:16px; border-radius:8px;"
  >
    No leaves yet.
  </div>

  <!-- Table -->
  <table
    *ngIf="!loading && leaves?.length"
    mat-table
    [dataSource]="leaves"
    class="mat-elevation-z2 full-table"
    style="width:100%;"
  >
    <!-- Type -->
    <ng-container matColumnDef="type">
      <th mat-header-cell *matHeaderCellDef>Type</th>
      <td mat-cell *matCellDef="let r">{{ r.leaveType }}</td>
    </ng-container>

    <!-- Dates -->
    <ng-container matColumnDef="dates">
      <th mat-header-cell *matHeaderCellDef>Dates</th>
      <td mat-cell *matCellDef="let r">
        {{ r.startDate | date }} â†’ {{ r.endDate | date }}
      </td>
    </ng-container>

    <!-- Reason -->
    <ng-container matColumnDef="reason">
      <th mat-header-cell *matHeaderCellDef>Reason</th>
      <td mat-cell *matCellDef="let r">
        <span title="{{ r.reason }}">{{ r.reason }}</span>
      </td>
    </ng-container>

    <!-- Status -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let r">
        <mat-chip-set>
          <mat-chip [disabled]="true">{{ r.status }}</mat-chip>
        </mat-chip-set>
      </td>
    </ng-container>

    <!-- Actions -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let r">
        <button
          mat-stroked-button
          color="warn"
          (click)="cancel(r.id)"
          *ngIf="r.status === 'PENDING'"
        >
          Cancel
        </button>
      </td>
    </ng-container>

    <!-- Rows -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</div>
