<h2 class="page-title">Change Password</h2>

<mat-card class="password-card">
  <form>
    <!-- Old Password -->
    <div class="form-group">
        <label for="oldPassword">Old Password</label>
        <div class="input-container" [ngClass]="{ 'valid': isOldPasswordValid, 'invalid': oldPasswordTouched && !isOldPasswordValid }">
          <input
            id="oldPassword"
            [type]="showOldPassword ? 'text' : 'password'"
            [(ngModel)]="oldPassword"
            name="oldPassword"
            (ngModelChange)="validateOldPassword()"
            (blur)="oldPasswordTouched = true"
          />
         
          <mat-icon *ngIf="oldPasswordTouched" class="status-icon">
            {{ isOldPasswordValid ? 'check_circle' : 'cancel' }}
          </mat-icon>
          <mat-icon class="visibility-icon" (click)="showOldPassword = !showOldPassword">
            {{ showOldPassword ? 'visibility_off' : 'visibility' }}
          </mat-icon>
           
        </div>
         <!-- Error message -->
         <mat-error *ngIf="oldPasswordTouched && !isOldPasswordValid">
            {{ oldPasswordErrorMessage }}
          </mat-error>
      </div>
      

   <!-- New Password -->
<div class="form-group">
    <label for="newPassword">New Password</label>
    <div class="input-container" [ngClass]="{ 'valid': isNewPasswordValid, 'invalid': newPasswordTouched && !isNewPasswordValid }">
        <input
          id="newPassword"
          [type]="showNewPassword ? 'text' : 'password'"
          [(ngModel)]="newPassword"
          name="newPassword"
          (ngModelChange)="validateNewPassword()"
          (blur)="newPasswordTouched = true"
        />
     
        <mat-icon *ngIf="newPasswordTouched" class="status-icon">
          {{ isNewPasswordValid ? 'check_circle' : 'cancel' }}
        </mat-icon>
        <mat-icon class="visibility-icon" (click)="showNewPassword = !showNewPassword">
            {{ showNewPassword ? 'visibility_off' : 'visibility' }}
          </mat-icon>
      </div>
  
    <ul class="validation-list">
      <li [class.invalid-rule]="!passwordRules.minLength">
        <mat-icon class="rule-icon" [ngClass]="passwordRules.minLength ? 'valid-icon' : 'invalid-icon'">
          {{ passwordRules.minLength ? 'check_circle' : 'cancel' }}
        </mat-icon>
        Minimum 6 characters
      </li>
      <li [class.invalid-rule]="!passwordRules.uppercase">
        <mat-icon class="rule-icon" [ngClass]="passwordRules.uppercase ? 'valid-icon' : 'invalid-icon'">
          {{ passwordRules.uppercase ? 'check_circle' : 'cancel' }}
        </mat-icon>
        One uppercase letter
      </li>
      <li [class.invalid-rule]="!passwordRules.lowercase">
        <mat-icon class="rule-icon" [ngClass]="passwordRules.lowercase ? 'valid-icon' : 'invalid-icon'">
          {{ passwordRules.lowercase ? 'check_circle' : 'cancel' }}
        </mat-icon>
        One lowercase letter
      </li>
      <li [class.invalid-rule]="!passwordRules.number">
        <mat-icon class="rule-icon" [ngClass]="passwordRules.number ? 'valid-icon' : 'invalid-icon'">
          {{ passwordRules.number ? 'check_circle' : 'cancel' }}
        </mat-icon>
        One number
      </li>
      <li [class.invalid-rule]="!passwordRules.specialChar">
        <mat-icon class="rule-icon" [ngClass]="passwordRules.specialChar ? 'valid-icon' : 'invalid-icon'">
          {{ passwordRules.specialChar ? 'check_circle' : 'cancel' }}
        </mat-icon>
        One special character
      </li>
    </ul>
  
    <p class="error-text" *ngIf="!isNewPasswordValid && newPasswordTouched">
      Please add all necessary characters to create a safe password.
    </p>
  </div>
  

    <!-- Confirm New Password -->
    <div class="form-group">
        <label for="confirmPassword">Confirm New Password</label>
        <div class="input-container" [ngClass]="{ 'valid': isConfirmPasswordValid, 'invalid': confirmTouched && !isConfirmPasswordValid }">
          <input
            id="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            (ngModelChange)="validateConfirmPassword()"
            (blur)="confirmTouched = true"
          />
          
          <mat-icon *ngIf="confirmTouched" class="status-icon">
            {{ isConfirmPasswordValid ? 'check_circle' : 'cancel' }}
          </mat-icon>
          <mat-icon class="visibility-icon" (click)="showConfirmPassword = !showConfirmPassword">
            {{ showConfirmPassword ? 'visibility_off' : 'visibility' }}
          </mat-icon>
        </div>
      </div>
      

    <!-- Button -->
 <button
  mat-raised-button
  color="primary"
  [disabled]="!canSubmit || isLoading"
  class="submit-button"
  (click)="changeNewPassword()"
  style="display: flex; align-items: center; justify-content: center; min-width: 140px; gap: 8px;"
>
  <mat-spinner *ngIf="isLoading" diameter="20" color="accent"></mat-spinner>
  <span *ngIf="!isLoading">Change Password</span>
</button>


  </form>
</mat-card>
